@page "/contacts"
@rendermode InteractiveServer
@using Microsoft.EntityFrameworkCore
@using Microsoft.AspNetCore.Components.QuickGrid
@using BlazorApp.Data
@inject ApplicationDbContext Db
@inject NavigationManager NavigationManager

<PageTitle>Contatos</PageTitle>

<h1>Contatos</h1>

<p>
    <button type="button" class="btn btn-primary" @onclick="CreateNewContact">Criar Novo</button>
</p>

<div class="d-none d-md-block">
    <QuickGrid Class="table table-striped" Items="contacts">
        <PropertyColumn Property="contact => contact.Name" Title="Nome" />
        <PropertyColumn Property="contact => contact.Email" />

        <TemplateColumn Align="Align.Center" Title="Ações" Context="contact">
            <a class="btn btn-sm btn-outline-primary" href="@($"contacts/edit?id={contact.Id}")">Editar</a>
            <a class="btn btn-sm btn-outline-secondary" href="@($"contacts/details?id={contact.Id}")">Detalhes</a>
            <a class="btn btn-sm btn-outline-danger" href="@($"contacts/delete?id={contact.Id}")">Deletar</a>
        </TemplateColumn>
    </QuickGrid>
</div>

<div class="d-md-none">
    @foreach (var contact in contacts)
    {
        <div class="card mb-3 shadow-sm">
            <div class="card-body">
                <h5 class="card-title">@contact.Name</h5>
                <p class="card-text">
                    <strong>Email:</strong> @contact.Email
                </p>

                <div class="d-flex gap-2">
                    <a class="btn btn-sm btn-outline-primary" href="@($"contacts/edit?id={contact.Id}")">
                        Editar
                    </a>
                    <a class="btn btn-sm btn-outline-secondary" href="@($"contacts/details?id={contact.Id}")">
                        Detalhes
                    </a>
                    <a class="btn btn-sm btn-outline-danger" href="@($"contacts/delete?id={contact.Id}")">
                        Deletar
                    </a>
                </div>
            </div>
        </div>
    }
</div>

@code {
    private IQueryable<Contact> contacts = default!;

    protected override void OnInitialized()
    {
        contacts = Db.Contacts.AsNoTracking();
    }

    private void CreateNewContact()
    {
        NavigationManager.NavigateTo("/contacts/create");
    }
}
